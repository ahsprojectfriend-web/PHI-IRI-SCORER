<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHI-IRI Scorer | Google Edition</title>
    <style>
        :root {
            --google-blue: #1a73e8;
            --google-light-blue: #e8f0fe;
            --google-dark-blue: #174ea6;
            --google-red: #d93025;
            --google-green: #1e8e3e;
            --google-gray: #5f6368;
            --surface: #ffffff;
            --background: #f8f9fa;
        }

        body {
            font-family: 'Google Sans', Roboto, Arial, sans-serif;
            background-color: var(--background);
            color: #3c4043;
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            background: var(--surface);
            max-width: 850px;
            width: 100%;
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 1px 3px rgba(60,64,67,0.3), 0 4px 8px rgba(60,64,67,0.15);
            position: relative;
        }

        /* Google Style Settings Gear */
        .settings-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            background: transparent;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--google-gray);
            transition: background 0.3s;
        }

        .settings-btn:hover {
            background: rgba(95, 99, 104, 0.1);
            color: var(--google-blue);
        }

        h1 { 
            color: var(--google-blue); 
            text-align: center; 
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: 500;
        }
        
        #timer-display {
            font-size: 4rem;
            text-align: center;
            color: var(--google-red);
            font-weight: 400;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 35px;
        }

        .btn {
            padding: 12px 32px;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid #dadce0;
            border-radius: 100px; /* Pill shape */
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: .25px;
        }

        #startBtn { 
            background: var(--google-blue); 
            color: white; 
            border: none;
        }
        #startBtn:hover { background: var(--google-dark-blue); box-shadow: 0 1px 2px rgba(66,133,244,0.3), 0 1px 3px 1px rgba(66,133,244,0.15); }

        #stopBtn { background: white; color: var(--google-red); border-color: #f1f3f4; }
        #stopBtn:hover { background: #fff1f0; }

        .btn:disabled { background: #f1f3f4; color: #9aa0a6; cursor: not-allowed; border: none; }

        /* Passage Area */
        #passage-area {
            border: 1px solid #dadce0;
            padding: 30px;
            border-radius: 16px;
            line-height: 1.8;
            font-size: 1.15rem;
            margin-bottom: 30px;
            background: var(--google-light-blue);
        }

        .word {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.1s;
            border: 1px solid transparent;
        }

        .word:hover { background: rgba(26, 115, 232, 0.1); }

        .word.error {
            background-color: var(--google-red);
            color: white;
            text-decoration: line-through;
        }

        /* Inputs Grid */
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .field label { 
            display: block; 
            font-weight: 500; 
            margin-bottom: 8px; 
            font-size: 13px;
            color: var(--google-gray);
        }
        .field input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #dadce0;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            transition: border 0.2s;
        }
        .field input:focus {
            outline: none;
            border: 2px solid var(--google-blue);
            padding: 11px 15px;
        }

        /* Results & Submit */
        #results {
            margin-top: 20px;
            padding: 24px;
            border-radius: 12px;
            display: none;
            text-align: center;
        }

        .Independent { background: #e6f4ea; color: #137333; }
        .Instructional { background: #fef7e0; color: #b06000; }
        .Frustration { background: #fce8e6; color: #c5221f; }

        .submit-btn {
            width: 100%;
            background: var(--google-green);
            color: white;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            margin-top: 20px;
            cursor: pointer;
            display: none;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* Settings Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(32, 33, 36, 0.6);
            z-index: 1000;
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            margin: 80px auto;
            padding: 32px;
            border-radius: 24px;
            text-align: center;
            box-shadow: 0 24px 38px 3px rgba(0,0,0,0.14);
        }
    </style>
</head>
<body>

<div class="container">
    <button class="settings-btn" onclick="openSettings()">⚙️</button>
    
    <h1>PHI-IRI Oral Fluency Scorer</h1>
    <div id="timer-display">10:00</div>

    <div class="controls">
        <button id="startBtn" class="btn" onclick="startTest()">Start Test</button>
        <button id="stopBtn" class="btn" onclick="stopTest()" disabled>Stop & Calculate</button>
    </div>

    <div id="passage-area">
        </div>

    <div class="data-grid">
        <div class="field">
            <label>Student Full Name</label>
            <input type="text" id="studentName" placeholder="e.g. Juan Dela Cruz">
        </div>
        <div class="field">
            <label>Cumulative Word Count</label>
            <input type="number" id="wordsRead" value="124">
        </div>
        <div class="field">
            <label>Miscues (Automatic)</label>
            <input type="number" id="miscueCount" value="0" readonly>
        </div>
        <div class="field">
            <label>Comprehension Score (0-7)</label>
            <input type="number" id="compScore" value="0" min="0" max="7">
        </div>
    </div>

    <div id="results"></div>
    <button id="submitBtn" class="submit-btn" onclick="sendData()">Compile to Google Sheets</button>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <h2 style="font-weight: 500; margin-top: 0;">Admin Settings</h2>
        <div id="loginStep">
            <input type="password" id="adminPw" style="width:100%; padding:12px; border: 1px solid #dadce0; border-radius: 8px;" placeholder="Password">
            <button class="btn" style="width:100%; margin-top:16px; background:var(--google-blue); color:white; border:none;" onclick="checkPassword()">Unlock</button>
        </div>
        <div id="configStep" style="display:none;">
            <p style="font-size: 14px; color: var(--google-gray);">Google Apps Script Web App URL:</p>
            <textarea id="sheetUrl" style="width:100%; height:100px; padding:10px; border: 1px solid #dadce0; border-radius: 8px;"></textarea>
            <button class="btn" style="width:100%; margin-top:16px; background:var(--google-green); color:white; border:none;" onclick="saveConfig()">Save Configuration</button>
        </div>
        <button class="btn" style="width:100%; margin-top:12px;" onclick="closeSettings()">Cancel</button>
    </div>
</div>

<script>
    const passageText = "When men decided to divide the day into twenty-four hours, they used numbers one through twelve two times. As a result, there was one o’clock during the day and another one o’clock after midnight. This created confusion. If one was told to submit a project at six o’clock, did this mean six o’clock in the morning or at night? The Romans provided a solution to this problem. They thought that noon time, the time when the sun is at its apex, is an important time. They called noon Meridies and measured time by this. They called the morning ante meridiem, which means “before noon” while “after noon” was called post meridiem. Ante meridiem was shortened to A.M. while post meridiem was shortened to P.M.";

    let timeLeft = 600;
    let timer;
    let startTime;
    let finalPayload = {};

    // Create words
    const area = document.getElementById('passage-area');
    passageText.split(' ').forEach(w => {
        const s = document.createElement('span');
        s.className = 'word'; s.innerText = w + ' ';
        s.onclick = function() {
            this.classList.toggle('error');
            document.getElementById('miscueCount').value = document.querySelectorAll('.word.error').length;
        };
        area.appendChild(s);
    });

    function startTest() {
        startTime = Date.now();
        document.getElementById('startBtn').disabled = true;
        document.getElementById('stopBtn').disabled = false;
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60), s = timeLeft%60;
            document.getElementById('timer-display').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            if(timeLeft <= 0) stopTest();
        }, 1000);
    }

    function stopTest() {
        clearInterval(timer);
        const elapsed = (Date.now() - startTime) / 1000;
        const totalW = parseInt(document.getElementById('wordsRead').value);
        const errs = parseInt(document.getElementById('miscueCount').value);
        const comp = (parseInt(document.getElementById('compScore').value) / 7) * 100;
        
        const accuracy = ((totalW - errs) / totalW) * 100;
        const wpm = (totalW / elapsed) * 60;

        let profile = "Frustration";
        if (accuracy >= 97 && comp >= 80) profile = "Independent";
        else if (accuracy >= 90 && comp >= 59) profile = "Instructional";

        const res = document.getElementById('results');
        res.className = profile;
        res.style.display = 'block';
        res.innerHTML = `<h2 style="margin:0">${profile}</h2><p>Accuracy: ${accuracy.toFixed(1)}% | Speed: ${wpm.toFixed(0)} WPM</p>`;
        
        finalPayload = {
            timestamp: new Date().toLocaleString(),
            name: document.getElementById('studentName').value || "Anonymous",
            accuracy: accuracy.toFixed(1) + "%",
            wpm: wpm.toFixed(0),
            profile: profile
        };
        document.getElementById('submitBtn').style.display = 'block';
    }

    function openSettings() { document.getElementById('settingsModal').style.display = 'block'; }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }
    
    function checkPassword() {
        if(document.getElementById('adminPw').value === "Admin123") {
            document.getElementById('loginStep').style.display = 'none';
            document.getElementById('configStep').style.display = 'block';
            document.getElementById('sheetUrl').value = localStorage.getItem('phil_iri_url') || "";
        } else { alert("Wrong Password"); }
    }

    function saveConfig() {
        localStorage.setItem('phil_iri_url', document.getElementById('sheetUrl').value);
        alert("Saved!");
        closeSettings();
    }

    async function sendData() {
        const url = localStorage.getItem('phil_iri_url');
        if(!url) return alert("No Sheet URL Configured!");
        try {
            await fetch(url, { method: 'POST', mode: 'no-cors', body: JSON.stringify(finalPayload) });
            alert("Sent to Google Sheets!");
        } catch(e) { alert("Error sending data."); }
    }
</script>
</body>
</html>
